<!DOCTYPE html>
<html>
<head>
  <title>User Management</title>
  <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>

<script>
  const user = JSON.parse(localStorage.getItem("currentUser"));
  if (!user || user.role !== "admin") {
    location.href = "../auth/login.html";
  }
</script>

<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h2>Flawless ERP</h2>
    <a href="admin-dashboard.html">Dashboard</a>
    <a class="active" href="users.html">Users</a>
    <a href="#" onclick="logout()">Logout</a>
  </div>

  <!-- MAIN -->
  <div class="main">

    <div class="header">
      <h1>User Management</h1>
    </div>

    <div class="card">
      <h3>Create User</h3><br>

      <input id="name" placeholder="Full Name"><br><br>
      <input id="email" placeholder="Email"><br><br>
      <input id="password" placeholder="Password"><br><br>

      <select id="role">
        <option value="">Select Role</option>
        <option value="hr">HR</option>
        <option value="teacher">Teacher</option>
        <option value="student">Student</option>
        <option value="parent">Parent</option>
      </select><br><br>

      <button onclick="createUser()">Create User</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>

  </div>
</div>

<script src="../core/datastore.js"></script>
<script src="../core/auth.js"></script>
<script>

function createUser() {
  const db = JSON.parse(localStorage.getItem("DB"));

  const user = {
    id: Date.now(),
    name: name.value,
    email: email.value,
    password: password.value,
    role: role.value
  };

  if (!user.name || !user.email || !user.password || !user.role) {
    alert("Fill all fields");
    return;
  }

  db.users.push(user);
  localStorage.setItem("DB", JSON.stringify(db));
  loadUsers();
}

function loadUsers() {
  const db = JSON.parse(localStorage.getItem("DB"));
  const table = document.getElementById("userTable");
  table.innerHTML = "";

  db.users.forEach(u => {
    table.innerHTML += `
      <tr>
        <td>${u.name}</td>
        <td>${u.email}</td>
        <td>${u.role}</td>
      </tr>
    `;
  });
}

loadUsers();
</script>

</body>
</html>
